#include "stdafx.h"
#include <stdio.h>   
#include <math.h>  
using namespace std;

void Muscle::mus_tendon_length_calc(Muscle **muscle_data[], XML_Parameters* _parameters, int frames, int muscle) {


/*	double horseman_tendon_lengths[163] = { 0,	0	,0	,0	,0	,0	,0	,0	,0,	0	,0	,0	,0.042,	0.042	,0.042	,0	,0	,0	,0	,0	,0	,0	,0	,0	,0	,0.13	,0.031	,0.031	,0.031	,
		0.301	,0.301	,0.301	,0.178	,0.178	,0.178	,0.166	,0.166	,0.166	,0.234	,0.234	,0.234	,0.234,	0.212	,0	,0	,0	,0	,0	,0	,0	,0	,0	,0	,0	,0	,0	,0	,0	,0	,0	,0	,
		0,	0	,0.03	,0.03	,0.03	,0.03	,0.03	,0.03	,0.073,	0.073	,0.073	,0.14	,0.14	,0.113	,0.113	,0.113	,0.113	,0.113	,0.113	,0.155	,0.155	,0.155	,0.035	,0.035	,
		0.03	,0.03	,0.03	,0.082	,0.082	,0.082	,0	,0	,0	,0	,0.064	,0.064	,0.064	,0.159	,0.159	,0.159	,0.1	,0.1	,0.1	,0.016	,0.35	,0.01	,0.01	,0.152	,0.113	,
		0.113	,0.113	,0	,0	,0	,0	,0.096	,0.096	,0.079	,0.079	,0.157	,0.237	,0.085	,0.085	,0.085	,0.085	,0.085	,0.085	,0	,0,	0.235	,0.235	,0.235	,0.11	,0.11	,0.11	,
		0.11	,0.11	,0.11	,0.126	,0.126	,0.126	,0.126	,0.126	,0.126	,0.096	,0.096	,0.096	,0.096	,0.096	,0.096	,0.096	,0.096	,0.096	,0.096	,0.096	,0.096	,0.096	,0.096	,
		0.096	,0.096	,0.096	,0.096 };

	double rajagopal_tendon_lengths[163] = { 0.035,	0.035,	0.035,	0.035,	0.035,	0.035,	0.132,	0.132,	0.132,	0.132,	0.132,	0.132,	0.087,	0.087,	0.087,	0.047,	0.047,	0.047,	0.047,
		0.047,	0.047,	0.04,	0.04,	0.04,	0.04,	0.325,	0.106,	0.106,	0.106,	0.369,	0.369,	0.369,	0.327,	0.327,	0.327,	0.379,	0.379,	0.379,	0.354,	0.354,	0.354,	0.376,
		0.399,	0,	0,	0.049,	0.049,	0.049,	0.049,	0.049,	0.049,	0.07,	0.07,	0.07,	0.07,	0.07,	0.07,	0.056,	0.056,	0.056,	0.056,	0.056,	0.056,	0.045,	0.045,	0.045,
		0.045,	0.045,	0.045,	0.016,	0.026,	0.051,	0.172,	0.172,	0.096,	0.096,	0.096,	0.096,	0.096,	0.096,	0.096,	0.096,	0.096,	0.035,	0.035,	0.03,	0.03,	0.03,	0.082,
		0.082,	0.082,	0,	0,	0,	0,	0.148,	0.148,	0.148,	0.332,	0.332,	0.332,	0.1,	0.1,	0.1,	0.115,	0.35,	0.01,	0.01,	0.1,	0.1,	0.1,	0.1,	0,	0,	0,	0,
		0.449,	0.449,	0.124,	0.124,	0.348,	0.247,	0.277,	0.277,	0.277,	0.277,	0.277,	0.277,	0.45,	0.45,	0.241,	0.241,	0.241,	0.281,	0.281,	0.281,	0.281,	0.281,	0.281,
		0.202,	0.202,	0.202,	0.202,	0.202,	0.202,	0.221,	0.221,	0.221,	0.221,	0.221,	0.221,	0.221,	0.221,	0.2,	0.2,	0.2,	0.2,	0.2,	0.2,	0.2,	0.2,	0.2,
		0.2 };


	//this->tendon_length = rajagopal_tendon_lengths[muscle]*((_parameters->subject_height) / 1.74);*/

	double temp = 0;

	double horseman_opt_lengths[163] = { 0.095, 0.095, 0.104, 0.104, 0.112, 0.112, 0.106, 0.106, 0.106, 0.106, 0.106, 0.106, 0.108, 0.108, 0.108, 0.104, 0.104, 0.104, 0.104, 0.104, 0.104,
		0.107, 0.107, 0.107, 0.107, 0.085, 0.091, 0.091, 0.091, 0.06, 0.06, 0.06, 0.06, 0.06, 0.06, 0.038, 0.038, 0.038, 0.026, 0.026, 0.026, 0.057, 0.06, 0.034, 0.034, 0.12, 0.12, 0.12, 0.12,
		0.12, 0.12, 0.151, 0.151, 0.151, 0.151, 0.151, 0.151, 0.038, 0.038, 0.038, 0.038, 0.038, 0.038, 0.045, 0.045, 0.045, 0.045, 0.045, 0.045, 0.028, 0.034, 0.037, 0.181, 0.181, 0.103, 0.103,
		0.103, 0.052, 0.052, 0.052, 0.089, 0.089, 0.089, 0.069, 0.069, 0.028, 0.028, 0.028, 0.021, 0.021, 0.021, 0.115, 0.115, 0.115, 0.115, 0.027, 0.027, 0.027, 0.034, 0.034, 0.034, 0.043, 0.043,
		0.043, 0.039, 0.048, 0.024, 0.024, 0.059, 0.099, 0.099, 0.099, 0.034, 0.034, 0.034, 0.034, 0.078, 0.078, 0.347, 0.347, 0.081, 0.142, 0.024, 0.024, 0.024, 0.026, 0.026, 0.026, 0.095, 0.095,
		0.046, 0.046, 0.046, 0.024, 0.024, 0.024, 0.024, 0.024, 0.024, 0.077, 0.077, 0.077, 0.077, 0.077, 0.077, 0.042, 0.042, 0.042, 0.042, 0.042, 0.042, 0.091, 0.091, 0.076, 0.076, 0.076, 0.076,
		0.083, 0.083, 0.083, 0.083, 0.083, 0.083 };

	// Use Horsman's data on optimal fibre length, scaled linearly to subject height

	this->optimal_length = horseman_opt_lengths[muscle] * ((_parameters->subject_height) / 1.74); 

	// Calculate tendon length that provides optimal force at average MT length seen during trial

	for (int i = 0; i < frames; i++)
	{

			temp = temp + muscle_data[i][muscle]->length;

	}

			this->tendon_length = temp / frames - this->optimal_length;

			// This routine produces negative values of tendon length for adductor brevis (optimal fibre length is longer than range of lengths for MT actuator)
	
			if (this->tendon_length < 0) {

				this->tendon_length = 0;
			}
return; 


}
